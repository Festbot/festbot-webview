language: node_js
node_js:
- '8'
install:
- npm install
script:
- npm run build
cache:
  directories:
  - node_modules
addons:
  ssh_known_hosts: chatbot.festbot.com
env:
- REMOTE_DIR_PROD=web/chatbot.festbot.com/public_html REMOTE_HOST=chatbot.festbot.com
before_deploy:
- echo $encrypted_1442971e22a8_key > $TRAVIS_BUILD_DIR/out/key.txt
- echo $encrypted_1442971e22a8_iv > $TRAVIS_BUILD_DIR/out/iv.txt
- echo $SSH_PROD_USER > $TRAVIS_BUILD_DIR/out/prod.txt
- openssl aes-256-cbc -K $encrypted_1442971e22a8_key -iv $encrypted_1442971e22a8_iv
  -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
deploy:
- provider: script
  skip_cleanup: true
  script: rsync -azP $TRAVIS_BUILD_DIR/out/ $SSH_PROD_USER@$REMOTE_HOST:$REMOTE_DIR_PROD
  on:
    branch: master

